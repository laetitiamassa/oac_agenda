<!--Attach the Table CSS and Javascript-->
<h1 class="text-center">Agenda des evenement en court d'organisation</h1>

<!-- place pour la sidebar -->
<aside class="left large-2 columns" >
 <article id="sidebar" class="events-press-cta panel sticky">
        <p class="lead">What are you going to do with it?</p>
        <p class="lead">Can't we just let it go? It's not harming anyone.</p>
        <p>How we can help:
          <ul>
            <li>Feature it here!</li>
            <li>Help promote it.</li>
            <li>Review material for accuracy.</li>
            <li>Stickers!</li>
          </ul>

        </p>
        <a class="tiny button" href="#">Contact us</a>
  </article>

</div>
</aside>

<div class="row calendar">
<div class=" large-10 columns">
  <div class="text-center">
    <% start_date = params.fetch(:start_date, Date.today).to_date %>
    <% date_range = (start_date.beginning_of_month.beginning_of_week..start_date.end_of_month.end_of_week).to_a %>
    <%= link_to start_date: date_range.first - 1.day do %><t class="button success round"><b><</b></t><% end %>
    <font style="text-transform: uppercase;"><%= l(start_date, format: :mname) %> </font>
    <%= link_to start_date: date_range.last + 1.day do %><t class="button success round"><b>></b></t><% end %>
  </div>
  <table class="calendar" style="border-spacing: 0">
    <thead>
      <tr>
        <th width="300">Lun</th>
        <th width="300">Mar</th>
        <th width="300">Mer</th>
        <th width="300">Jeu</th>
        <th width="300">Ven</th>
        <th width="300">Sam</th>
        <th width="300">Dim</th>
      </tr>
    </thead>
    <tbody>
      <% date_range.each_slice(7) do 	|semain| %>
      <tr>
        <% semain.each do 	|jour| %>

        <td class="active">
          <% @foldate = Foldate.new(datefolwd: jour, user_id: current_user.id) %>
          <% @addevent = Event.new(esdate_date: jour, esdate_time: "", orgn_id: current_user.orgn.first.id, eedate_date: jour , esdate_time: "" ) %>
          <% @user_date = current_user.foldates.where(:datefolwd => jour) %>
          <% @del_date = current_user.foldates.where(:datefolwd => jour).first %>
          <% @followed_date = Foldate.where(:datefolwd => jour) %>
          <!--les dates anterieur au mois actuelle en gris-->
          <% if jour.month < Date.today.month %>
            <span class="day"><font color="grey"><del><%=l(jour, format: :justd)%></del></font><hr></hr></span>

          <!--les dates posterieur au mois actuelle en verts avec l'option de suivre la dates-->
          <% elsif jour.month > Date.today.month %>
            <span class="day" >
              <font color="grey"><%= l(jour, format: :justd) %></font>
                <%= render partial: 'datefonctions', :locals => {:jour => jour} %>
            <hr></hr>
            </span>

          <!--les dates du mois actuelle mais anterieur a today en verts barrÃ©-->
          <% elsif jour < Date.today %>
            <span class="day"><del><font color="green"><%= l(jour, format: :justd) %>.</font></del><hr></hr></span>

          <!--today en bien visible avec l'option de suivre la dates-->
          <% elsif jour == Date.today %>
            <span class="day">
              <font color="orange"><b><%= l(jour, format: :justd) %>.</b></font>
                <%= render partial: 'datefonctions', :locals => {:jour => jour} %>
            <hr></hr>
            </span>

          <!--les dates du mois actuelle apres today verts gras avec l'option de suivre la dates-->
          <% else %>
            <span class="day">
                <b><font color="green"><%= l(jour, format: :justd) %>.</font></b>
                <%= render partial: 'datefonctions', :locals => {:jour => jour} %>
            <hr></hr>
            </span>
          <% end %>

          <% @events.each do |event| %>
            <% event.event_dates.select{ |m| m == jour}.each do |ed| %>
              <% if event.esdate <= Time.now %>
                <font size="0.5"><span class="event grey"><%= event.enom %></span></font>
              <% elsif event.public == true %>
                <font size="0.5" color = "black"><span class="event green"><%= link_to event.enom, event %></span></font>
              <% elsif event.public == false  %>
                <font size="0.5" color = "black"><span class="event yellow"><%= link_to event.enom, event %></span></font>
              <% end %>
            <% end %>
          <% end %>
        </td>
        <%end%>
      </tr>
    <% end %>
    </tbody>
  </table>
</div>
</div>
<br>
